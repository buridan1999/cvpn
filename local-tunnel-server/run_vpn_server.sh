#!/bin/bash

# Ð—Ð°Ð¿ÑƒÑÐº Ñ‚Ð¾Ð»ÑŒÐºÐ¾ VPN ÑÐµÑ€Ð²ÐµÑ€Ð° (ÑƒÐ´Ð°Ð»ÐµÐ½Ð½Ð°Ñ Ñ‡Ð°ÑÑ‚ÑŒ)
# ÐŸÐ¾Ñ€Ñ‚ 8080 - Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ Ð·Ð°ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ Ð¾Ñ‚ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ñ‚ÑƒÐ½Ð½ÐµÐ»Ñ

cd "$(dirname "$0")"

echo "ðŸ”Œ Ð—Ð°Ð¿ÑƒÑÐº VPN ÑÐµÑ€Ð²ÐµÑ€Ð° (ÑƒÐ´Ð°Ð»ÐµÐ½Ð½Ð°Ñ Ñ‡Ð°ÑÑ‚ÑŒ)..."
echo "   ÐŸÑ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ Ð·Ð°ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 8080"
echo "   ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ÑÑ Ðº Ñ†ÐµÐ»ÐµÐ²Ñ‹Ð¼ ÑÐµÑ€Ð²ÐµÑ€Ð°Ð¼ Ð² Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ðµ"
echo ""

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ ÐºÐ¾Ð½Ñ„Ð¸Ð³ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ VPN ÑÐµÑ€Ð²ÐµÑ€Ð°
cat > config_server.json << 'EOF'
{
    "server": {
        "host": "0.0.0.0",
        "port": 8080,
        "max_connections": 100,
        "timeout": 30
    },
    "tunnel": {
        "host": "127.0.0.1",
        "port": 8084
    },
    "encryption": {
        "algorithm": "xor",
        "library": "./build/encryption_plugins/xor_encryption",
        "key": "42"
    },
    "server_mode": "tunnel_only",
    "logging": {
        "level": "info",
        "file": "",
        "format": "timestamp"
    }
}
EOF

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ VPN ÑÐµÑ€Ð²ÐµÑ€
./build/local-tunnel-server config_server.json

# Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ ÐºÐ¾Ð½Ñ„Ð¸Ð³
rm -f config_server.json